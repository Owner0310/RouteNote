<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>RouteNote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/style.css" rel="stylesheet" type="text/css" />

    <!-- Firebase 9 compatç‰ˆ --><!-- Firebase 9 compatç‰ˆ -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- js èª­ã¿è¾¼ã¿ -->
    <script src="js/account/account.js" defer></script>
    <script src="js/account/profile.js" defer></script>
    <script src="js/account/signup.js" defer></script>
    <script src="js/account/login.js" defer></script>
</head>
<body>
    <main>
        <header>
            <nav class="header-nav">
                <h1 class="site-title"><a href="/index.html">RouteNote</a></h1>
                <ul class="nav-links">
                <li><a href="/index.html">ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="/itinerary/itinerary.html">æ—…ç¨‹ç®¡ç†</a></li>
                <li>
                    <a href="/account/account.html">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</a>
                    <span id="accountIconWrapper">
                    <a href="/account/profile.html" id="accountIconLink">
                        <img src="/icon/guest.png" alt="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³" id="accountIcon" />
                    </a>
                    </span>
                </li>
                </ul>
            </nav>
        </header>

        <h1>æ—…ç¨‹åˆ¶ä½œ</h1>

        <h2>ãƒ«ãƒ¼ãƒˆå…¥åŠ›</h2>
        <div class="form-section">
            <label>ãƒ«ãƒ¼ãƒˆå</label>
            <input type="text" class="must" id="routeName" placeholder="é‰„é“æ—¥æœ¬ä¸€å‘¨æ—…">
            
            <label>æ—¥ç¨‹</label>
            <input type="date" class="must" id="routeDate" placeholder="2000/01/01">
        </div>
        <button onclick="addRoute()">ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ </button>

        <h2>åŒºé–“å…¥åŠ›</h2>
        <div class="form-section">
            <label>ä¼šç¤¾å</label>
            <input type="text" id="company" placeholder="JRæ±æ—¥æœ¬">

            <label>è·¯ç·šå</label>
            <input type="text" class="must" id="line" placeholder="æ±æµ·é“ç·š">

            <label>ç¨®åˆ¥</label>
            <input type="text" class="must" id="type" placeholder="ç‰¹æ€¥">

            <label>åˆ—è»Šåç§°</label>
            <input type="text" id="trainName" placeholder="è¸Šã‚Šå­1å·">

            <label>å·è»Š</label>
            <input type="number" id="car" placeholder="4">

            <label>åº§å¸­</label>
            <input type="text" id="seat" placeholder="1A">

            <label>å§‹ç™ºé§…</label>
            <input type="text" id="start" placeholder="æ±äº¬">

            <label>çµ‚ç€é§…</label>
            <input type="text" class="must" id="destination" placeholder="ä¼Šè±†æ€¥ä¸‹ç”°">

            <label>ä¹—è»Šé§…</label>
            <input type="text" class="must" id="depStation" placeholder="å“å·">

            <label>å‡ºç™ºæ™‚é–“</label>
            <input type="time" class="must" id="depTime" placeholder="09:18">

            <label>å‡ºç™ºç•ªç·š</label>
            <input type="number" id="depPlatform" placeholder="12">

            <label>é™è»Šé§…</label>
            <input type="text" class="must" id="arrStation" placeholder="ç†±æµ·">

            <label>åˆ°ç€æ™‚é–“</label>
            <input type="time" class="must" id="arrTime" placeholder="10:20">

            <label>åˆ°ç€ç•ªç·š</label>
            <input type="number" id="arrPlatform" placeholder="2">

            <label>ä¹—è»Šåˆ¸æ–™é‡‘</label>
            <input type="text" id="ticketPrice" placeholder="1980">

            <label>ç‰¹åˆ¥æ–™é‡‘</label>
            <input type="text" id="limitedPrice" placeholder="1580">
        </div>
        <button onclick="addSection()">åŒºé–“ã‚’è¿½åŠ </button>


        <h2>å‡ºåŠ›</h2>
        <textarea id="output" readonly></textarea>


        <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
        <button onclick="output()">å‡ºåŠ›</button>
        <button onclick="importJSON()">JSONã‚’èª­è¾¼</button>
        <button onclick="exportJSON()">JSONã‚’å‡ºåŠ›</button>


        <!--
        <h2>ğŸ”§ ãƒ«ãƒ¼ãƒˆï¼†åŒºé–“å…¥åŠ›</h2>
        <div class="form-section">
            <label>ãƒ«ãƒ¼ãƒˆå</label><input type="text" id="rouateName">
            <label>åŒºé–“ç¨®åˆ¥</label>
            <select id="routeType">
                <option>å¾€è·¯</option>
                <option>å¾©è·¯</option>
            </select>
            <label>ä¼šç¤¾å</label><input type="text" id="company">
            <label>è·¯ç·š</label><input type="text" id="line">
            <label>ç¨®åˆ¥</label><input type="text" id="type">
            <label>è¡Œãå…ˆ</label><input type="text" id="destination">
            <label>è¡Œå…ˆä¼šç¤¾</label><input type="text" id="destCompany">
            <label>å§‹ç™ºé§…</label><input type="text" id="startStation">
            <label>å§‹ç™ºä¼šç¤¾</label><input type="text" id="startCompany">
            <label>å‡ºç™ºé§…</label><input type="text" id="depStation">
            <label>å‡ºç™ºä¼šç¤¾</label><input type="text" id="depCompany">
            <label>å‡ºç™ºæ™‚é–“</label><input type="time" id="depTime">
            <label>å‡ºç™ºç•ªç·š</label><input type="number" id="depPlatform">
            <label>åˆ°ç€é§…</label><input type="text" id="arrStation">
            <label>åˆ°ç€ä¼šç¤¾</label><input type="text" id="arrCompany">
            <label>åˆ°ç€æ™‚é–“</label><input type="time" id="arrTime">
            <label>åˆ°ç€ç•ªç·š</label><input type="number" id="arrPlatform">
        </div>
        <button onclick="addSection()">é€šå¸¸åŒºé–“è¿½åŠ </button>

        <div class="form-section">
            <label>ç‰¹æ€¥åç§°</label><input type="text" id="expressName">
            <label>åŒºé–“</label><input type="text" id="expressSection">
            <label>æ™‚é–“</label><input type="text" id="expressTime">
            <label>æ–™é‡‘(è‡ªç”±å¸­)</label><input type="text" id="expressPrice">
            <label>ä¹—è»Šåˆ¸</label><input type="text" id="ticketPrice">
            <label>è‡ªç”±å¸­åˆ¸</label><input type="text" id="expressFree">
            <label>æŒ‡å®šå¸­åˆ¸</label><input type="text" id="expressReserved">
        </div>
        <button onclick="addExpress()">ç‰¹æ€¥è¿½åŠ </button>

        <h2>ç¾åœ¨ã®æ—…ç¨‹</h2>
        <div id="List"></div>

        <h2>ğŸ›  æ“ä½œ</h2>
        <button onclick="generateOutput()">å‡ºåŠ›</button>
        <button onclick="printItinerary()">å°åˆ·</button>
        <button onclick="exportCSV()">CSVã‚’DL</button>
        <button onclick="exportJSON()">JSONã‚’DL</button>
        <button onclick="toggleEditMode()" id="editToggle">ç·¨é›†å¯</button>
        <button class="btn-secondary" onclick="importJSON()">JSONèª­è¾¼</button>
        <button class="btn-secondary" onclick="importCSV()">CSVèª­è¾¼</button>
        <button onclick="saveToLocal()">ä¿å­˜</button>
        <button class="btn-danger" onclick="clearStorage()">å…¨ä¿å­˜å‰Šé™¤</button>

        <h2>ğŸ“„ å‡ºåŠ›çµæœ</h2>
        <textarea id="output" readonly></textarea>
    -->

            <footer>
                <p>&copy; 2025 RouteNote All rights reserved.</p>
            </footer>
    </main>

    <script>
        let itinerary = [];
        let editMode = true;
        let storageIndex = 0;
        let storageList = JSON.parse(localStorage.getItem("itineraryList") || "[]");




        // å¤‰æ•°å®£è¨€ ãƒ«ãƒ¼ãƒˆ
        let routeName = "";
        let routeDate = "";


        // å¤‰æ•°å®£è¨€ åŒºé–“
        let company = [];
        let line = [];
        let type = [];
        let trainName = [];
        let car = [];
        let seat = [];
        let start = [];
        let destination = [];
        let depStation = [];
        let depTime = [];
        let depPlatform = [];
        let arrStation = [];
        let arrTime = [];
        let arrPlatform = [];
        let ticketPrice = [];
        let limitedPrice = [];
        let ticket = 0;
        let limited = 0;


        // ãƒ«ãƒ¼ãƒˆè¿½åŠ 
        function addRoute() {
            if (!editMode)
                return alert("ã‚¨ãƒ©ãƒ¼ï¼šç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„");

            if (
                document.getElementById("routeName").value === "" ||
                document.getElementById("routeDate").value === ""
                )
                return alert("ã‚¨ãƒ©ãƒ¼ï¼šå¿…è¦äº‹é …ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");

            routeName = document.getElementById("routeName").value;
            routeDate = document.getElementById("routeDate").value;

            document.getElementById("routeName").value = "";
            document.getElementById("routeDate").value = "";
        }


        // åŒºé–“è¿½åŠ 
        function addSection() {
            if (!editMode)
                return alert("ã‚¨ãƒ©ãƒ¼ï¼šç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„");

            if (
                document.getElementById("line").value === "" ||
                document.getElementById("type").value === "" ||
                document.getElementById("destination").value === "" ||
                document.getElementById("depStation").value === "" ||
                document.getElementById("depTime").value === "" ||
                document.getElementById("arrStation").value === "" ||
                document.getElementById("arrTime").value === ""
                )
                return alert("ã‚¨ãƒ©ãƒ¼ï¼šå¿…è¦äº‹é …ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");

            company.push(document.getElementById("company").value);
            line.push(document.getElementById("line").value);
            type.push(document.getElementById("type").value);
            trainName.push(document.getElementById("trainName").value);
            car.push(document.getElementById("car").value);
            seat.push(document.getElementById("seat").value);
            start.push(document.getElementById("start").value);
            destination.push(document.getElementById("destination").value);
            depStation.push(document.getElementById("depStation").value);
            depTime.push(document.getElementById("depTime").value);
            depPlatform.push(document.getElementById("depPlatform").value);
            arrStation.push(document.getElementById("arrStation").value);
            arrTime.push(document.getElementById("arrTime").value);
            arrPlatform.push(document.getElementById("arrPlatform").value);
            ticketPrice.push(document.getElementById("ticketPrice").value);
            limitedPrice.push(document.getElementById("limitedPrice").value);

            document.getElementById("company").value = "";
            document.getElementById("line").value = "";
            document.getElementById("type").value = "";
            document.getElementById("trainName").value = "";
            document.getElementById("car").value = "";
            document.getElementById("seat").value = "";
            document.getElementById("start").value = "";
            document.getElementById("destination").value = "";
            document.getElementById("depStation").value = "";
            document.getElementById("depTime").value = "";
            document.getElementById("depPlatform").value = "";
            document.getElementById("arrStation").value = "";
            document.getElementById("arrTime").value = "";
            document.getElementById("arrPlatform").value = "";
            document.getElementById("ticketPrice").value = "";
            document.getElementById("limitedPrice").value = "";
        }


        // å‡ºåŠ›
        function output() {
            const output = document.getElementById("output");
            let result = "";

            // ãƒ«ãƒ¼ãƒˆåã¨æ—¥ä»˜ã®å‡ºåŠ›
            result += `# ${routeName}\n`;
            result += `ã€€${routeDate}\n\n`;

            // åˆè¨ˆæ–™é‡‘ç”¨ã®å¤‰æ•°ï¼ˆæ•°å€¤å‹ã«åˆæœŸåŒ–ï¼‰
            let ticket = 0;
            let limited = 0;

            for (let i = 0; i < line.length; i++) {
                result += `${depStation[i]}ç™ºã€€${depTime[i]}`;
                if (depPlatform[i] !== "") {
                    result += `ã€€${depPlatform[i]}ç•ªç·š`;
                }
                result += "\nï½œ\nï½œã€€";

                if (company[i] !== "") {
                    result += `${company[i]}ã€€`;
                }
                result += `${line[i]}ã€€${type[i]}ã€€`;
                if (trainName[i] !== "") {
                    result += `${trainName[i]}ã€€`;
                }
                if (start[i] !== "") {
                    result += `${start[i]}ç™ºã€€`;
                }
                result += `${destination[i]}è¡Œãã€€`;

                if (car[i] !== "" || seat[i] !== "") {
                    result += "\nï½œã€€";
                    if (car[i] !== "") {
                        result += `${car[i]}å·è»Šã€€`;
                    }
                    if (seat[i] !== "") {
                        result += `${seat[i]}å¸­ã€€`;
                    }
                }

                if (ticketPrice[i] !== "") {
                    result += `\nï½œã€€ä¹—è»Šåˆ¸æ–™é‡‘ï¼š${ticketPrice[i]}`;
                    ticket += Number(ticketPrice[i]) || 0;
                }
                if (limitedPrice[i] !== "") {
                    result += `\nï½œã€€ç‰¹åˆ¥æ–™é‡‘ã€€ï¼š${limitedPrice[i]}`;
                    limited += Number(limitedPrice[i]) || 0;
                }

                result += "\nï½œ\n";

                result += `${arrStation[i]}ç€ã€€${arrTime[i]}`;
                if (arrPlatform[i] !== "") {
                    result += `ã€€${arrPlatform[i]}ç•ªç·š`;
                }
                result += "\n\n";
            }

            if (ticket !== 0 || limited !== 0) {
                result += "\n";
                if (ticket !== 0) {
                    result += `ä¹—è»Šåˆ¸æ–™é‡‘åˆè¨ˆ\nã€€${ticket}\n`;
                }
                if (limited !== 0) {
                    result += `ç‰¹åˆ¥æ–™é‡‘åˆè¨ˆ\nã€€${limited}\n`;
                }
            }

            output.value = result;
        }



        // JSONå…¥åŠ›
        function importJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';

            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const json = JSON.parse(event.target.result);

                        // JSONã®ä¸­èº«ã‚’é©åˆ‡ãªå¤‰æ•°ã«ã‚»ãƒƒãƒˆã™ã‚‹ä¾‹
                        routeName = json.routeName || "";
                        routeDate = json.routeDate || "";

                        // é…åˆ—ã¯ç©ºã«ã—ã¦ã‹ã‚‰èª­ã¿è¾¼ã¿
                        company.length = 0;
                        line.length = 0;
                        type.length = 0;
                        trainName.length = 0;
                        car.length = 0;
                        seat.length = 0;
                        start.length = 0;
                        destination.length = 0;
                        depStation.length = 0;
                        depTime.length = 0;
                        depPlatform.length = 0;
                        arrStation.length = 0;
                        arrTime.length = 0;
                        arrPlatform.length = 0;
                        ticketPrice.length = 0;
                        limitedPrice.length = 0;

                        if (Array.isArray(json.sections)) {
                            for (const section of json.sections) {
                                company.push(section.company || "");
                                line.push(section.line || "");
                                type.push(section.type || "");
                                trainName.push(section.trainName || "");
                                car.push(section.car || "");
                                seat.push(section.seat || "");
                                start.push(section.start || "");
                                destination.push(section.destination || "");
                                depStation.push(section.depStation || "");
                                depTime.push(section.depTime || "");
                                depPlatform.push(section.depPlatform || "");
                                arrStation.push(section.arrStation || "");
                                arrTime.push(section.arrTime || "");
                                arrPlatform.push(section.arrPlatform || "");
                                ticketPrice.push(section.ticketPrice || "");
                                limitedPrice.push(section.limitedPrice || "");
                            }
                        }

                        // èª­ã¿è¾¼ã¿å¾Œã«ç”»é¢è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ã‚’å‘¼ã¶ï¼ˆã‚ã‚Œã°ï¼‰
                        displaySections();

                    } catch (err) {
                        alert("JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nå†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                        console.error(err);
                    }
                };

                reader.readAsText(file);
            };

            input.click();
        }


        // JSONå‡ºåŠ›
        function exportJSON() {
            if (routeName === "" || routeDate === "") {
                alert("ã‚¨ãƒ©ãƒ¼ï¼šå¿…è¦äº‹é …ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");
                return;
            }

            // ãƒ«ãƒ¼ãƒˆæƒ…å ±ã¨åŒºé–“æƒ…å ±ã‚’ã¾ã¨ã‚ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–
            const data = {
                routeName: routeName,
                routeDate: routeDate,
                sections: []
            };

            for (let i = 0; i < line.length; i++) {
                data.sections.push({
                    company: company[i],
                    line: line[i],
                    type: type[i],
                    trainName: trainName[i],
                    car: car[i],
                    seat: seat[i],
                    start: start[i],
                    destination: destination[i],
                    depStation: depStation[i],
                    depTime: depTime[i],
                    depPlatform: depPlatform[i],
                    arrStation: arrStation[i],
                    arrTime: arrTime[i],
                    arrPlatform: arrPlatform[i],
                    ticketPrice: ticketPrice[i],
                    limitedPrice: limitedPrice[i]
                });
            }

            // JSONæ–‡å­—åˆ—ã«å¤‰æ›
            const jsonStr = JSON.stringify(data, null, 2);

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨Blobã‚’ä½œæˆ
            const blob = new Blob([jsonStr], { type: "application/json" });

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;

            // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ«ãƒ¼ãƒˆåã«ã™ã‚‹ï¼ˆæ—¥æœ¬èªãƒ•ã‚¡ã‚¤ãƒ«åã®æ‰±ã„æ³¨æ„ï¼‰
            const fileName = `${routeName || "itinerary"}.json`;
            a.download = fileName;

            // è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹
            document.body.appendChild(a);
            a.click();

            // ã‚¯ãƒªãƒƒã‚¯å¾Œã«ãƒªãƒ³ã‚¯å‰Šé™¤ã€URLè§£æ”¾
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }













/*
            function renderToTextarea() {
                const outpaut = document.getElementById("outaput");
                let result = "";

                for (let i = 0; i < depStation.length; i++) {
                    if (depStation[i]) {
                    result += ${depStation[i]}ç™ºã€€${depTime[i]}\n;
                    }

                    result += "ï½œ\n";
                    result += ï½œã€€ã€€${line[i]}ã€€${kind[i]}ã€€${dest[i]}è¡Œã\n;
                    result += "ï½œ\n";

                    if (arrStation[i]) {
                    result += ${arrStation[i]}ç€ã€€${arrTime[i]}\n;
                    }
                }

                output.value = result;
            }




            let out = ãƒ«ãƒ¼ãƒˆ:${routeName.value}(${routeType.value})\n;
            itinerary.forEach(i => {
                if (i.type === "section") {
                    out += [é€šå¸¸] ${i.line} ${i.dep}â†’${i.arr}\n;
                } else {
                    out += [ç‰¹æ€¥] ${i.name} ${i.section}\n;
                }
            });
            output.value = out;







        function addSecaaation() {
            if (!editMode) return alert("ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ã¦ãã ã•ã„");
            itinerary.push({
                type: "section",
                company: company.value, line: type.value,
                kind: type.value, destination: destination.value,
                destCompany: destCompany.value, start: startStation.value,
                startCompany: startCompany.value, dep: depStation.value,
                depCompany: depCompany.value, depTime: depTime.value,
                depPlatform: depPlatform.value, arr: arrStation.value,
                arrCompany: arrCompany.value, arrTime: arrTime.value,
                arrPlatform: arrPlatform.value
            });
            render();
        }

        function addExpress() {
            if (!editMode) return alert("ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ã¦ãã ã•ã„");
            itinerary.push({
                type: "express", name: expressName.value,
                section: expressSection.value, time: expressTime.value,
                price: expressPrice.value, ticket: ticketPrice.value,
                free: expressFree.value, reserved: expressReserved.value
            });
            render();
        }

        function render() {
            const list = document.getElementById("itineraryList");
            list.innerHTML = "";
            itinerary.forEach((i, idx) => {
                const div = document.createElement("div");
                div.className = "itinerary-item";
                const span = document.createElement("span");
                span.textContent = i.type === "section"
                    ? ${i.company} ${i.line}(${i.kind}) ${i.dep}â†’${i.arr}
                    : ç‰¹æ€¥ ${i.name} ${i.section};
                const act = document.createElement("div");
                act.className = "actions";
                if (editMode) {
                    act.innerHTML = 
            <button onclick="editItem(${idx})">ç·¨é›†</button>
            <button class="btn-danger" onclick="deleteItem(${idx})">âœ•</button>
        ;
                }
                div.appendChild(span); div.appendChild(act);
                list.appendChild(div);
            });
        }

        function editItem(idx) {
            const i = itinerary[idx];
            if (i.type === "section") {
                company.value = i.company; line.value = i.line; type.value = i.kind;
                destination.value = i.destination; destCompany.value = i.destCompany;
                startStation.value = i.start; startCompany.value = i.startCompany;
                depStation.value = i.dep; depCompany.value = i.depCompany;
                depTime.value = i.depTime; depPlatform.value = i.depPlatform;
                arrStation.value = i.arr; arrCompany.value = i.arrCompany;
                arrTime.value = i.arrTime; arrPlatform.value = i.arrPlatform;
            } else {
                expressName.value = i.name; expressSection.value = i.section;
                expressTime.value = i.time; expressPrice.value = i.price;
                ticketPrice.value = i.ticket; expressFree.value = i.free;
                expressReserved.value = i.reserved;
            }
            deleteItem(idx);
        }

        function deleteItem(idx) {
            if (!editMode) return;
            itinerary.splice(idx, 1);
            render();
        }

        function generateOutput() {
            let out = ãƒ«ãƒ¼ãƒˆ:${routeName.value}(${routeType.value})\n;
            itinerary.forEach(i => {
                if (i.type === "section") {
                    out += [é€šå¸¸] ${i.line} ${i.dep}â†’${i.arr}\n;
                } else {
                    out += [ç‰¹æ€¥] ${i.name} ${i.section}\n;
                }
            });
            output.value = out;
        }

        function printItinerary() { window.print(); }

        function exportCSV() {
            let csv = "type,company,line,kind,dest,destCompany,start,startCompany,dep,depCompany,depTime,depPlat,arr,arrCompany,arrTime,arrPlat,expressName,section,time,price,ticket,free,reserved\n";
            itinerary.forEach(i => {
                if (i.type === "section") {
                    csv += section,${i.company},${i.line},${i.kind},${i.destination},${i.destCompany},${i.start},${i.startCompany},${i.dep},${i.depCompany},${i.depTime},${i.depPlatform},${i.arr},${i.arrCompany},${i.arrTime},${i.arrPlatform},,,,,,,\n;
                } else {
                    csv += ,,,,,,,,,,,,,,,${i.name},${i.section},${i.time},${i.price},${i.ticket},${i.free},${i.reserved}\n;
                }
            });
            const blob = new Blob(["\uFEFF" + csv], { type: "text/csv" });
            const a = Object.assign(document.createElement("a"), {
                href: URL.createObjectURL(blob),
                download: "itinerary.csv"
            });
            document.body.appendChild(a); a.click(); a.remove();
        }

        function importCSV() {
            if (!editMode) return alert("ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ã¦ãã ã•ã„");
            const f = document.createElement("input"); f.type = "file"; f.accept = ".csv"; f.onchange = () => {
                const r = new FileReader();
                r.onload = e => {
                    const lines = e.target.result.split(/\r?\n/).slice(1);
                    lines.forEach(l => {
                        const d = l.split(",");
                        if (d[0] === "section") {
                            itinerary.push({
                                type: "section",
                                company: d[1], line: d[2], kind: d[3], destination: d[4], destCompany: d[5],
                                start: d[6], startCompany: d[7], dep: d[8], depCompany: d[9],
                                depTime: d[10], depPlatform: d[11],
                                arr: d[12], arrCompany: d[13], arrTime: d[14], arrPlatform: d[15]
                            });
                        } else if (d[0] === "express") {
                            itinerary.push({
                                type: "express", name: d[16], section: d[17],
                                time: d[18], price: d[19], ticket: d[20],
                                free: d[21], reserved: d[22]
                            });
                        }
                    });
                    render();
                };
                r.readAsText(f.files[0]);
            };
            f.click();
        }

        function exportJSON() {
            const data = JSON.stringify({ meta: { routeName: routeName.value, routeType: routeType.value }, itinerary }, null, 2);
            const blob = new Blob([data], { type: "application/json" });
            const a = Object.assign(document.createElement("a"), {
                href: URL.createObjectURL(blob),
                download: "itinerary.json"
            });
            document.body.appendChild(a); a.click(); a.remove();
        }

        function importJSON() {
            if (!editMode) return alert("ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ã¦ãã ã•ã„");
            const f = document.createElement("input"); f.type = "file"; f.accept = ".json"; f.onchange = () => {
                const r = new FileReader();
                r.onload = e => {
                    const obj = JSON.parse(e.target.result);
                    routeName.value = obj.meta.routeName;
                    routeType.value = obj.meta.routeType;
                    itinerary = obj.itinerary || [];
                    render();
                };
                r.readAsText(f.files[0]);
            };
            f.click();
        }

        function saveToLocal() {
            if (!editMode) return alert("ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã—ã¦ãã ã•ã„");
            const obj = { meta: { routeName: routeName.value, routeType: routeType.value }, itinerary };
            storageList.push(obj);
            localStorage.setItem("itineraryList", JSON.stringify(storageList));
            alert("ä¿å­˜ã—ã¾ã—ãŸ");
            editMode = false;
            document.getElementById("editToggle").textContent = "ç·¨é›†å¯";
            render();
        }

        function clearStorage() {
            if (confirm("å…¨ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                localStorage.removeItem("itineraryList");
                storageList = [];
                alert("å‰Šé™¤ã—ã¾ã—ãŸ");
            }
        }

        function toggleEditMode() {
            editMode = !editMode;
            document.getElementById("editToggle").textContent = editMode ? "ç·¨é›†ä¸­" : "è¡¨ç¤ºå°‚ç”¨";
        }

        window.onload = render;


        */
    </script>

</body>

</html>